"use strict";angular.module("wgCart",["wgCart.directives"]).config([function(){}]).provider("$wgCart",function(){this.$get=function(){}}).run(["$rootScope","wgCart","wgCartItem","store",function(t,e,i,r){t.$on("wgCart:change",function(){e.$save()}),angular.isObject(r.get(this.getCartName()))?e.$restore(r.get(this.getCartName())):e.init()}]).service("wgCart",["$rootScope","wgCartItem","store",function(t,e,i){this.init=function(){this.$cart={shipping:null,taxRate:null,tax:null,items:[]},this.cartName="cart"},this.addItem=function(i,r,a,n,s){var o=this.getItemById(i);if("object"==typeof o)o.setQuantity(n,!1);else{var c=new e(i,r,a,n,s);this.$cart.items.push(c),t.$broadcast("wgCart:itemAdded",c)}t.$broadcast("wgCart:change",{})},this.getItemById=function(t){var e=this.getCart().items,i=!1;return angular.forEach(e,function(e){e.getId()===t&&(i=e)}),i},this.setCartName=function(t){this.cartName=t},this.getCartName=function(){return this.cartName},this.setShipping=function(t){return this.$cart.shipping=t,this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setTaxRate=function(t){return this.$cart.taxRate=+parseFloat(t).toFixed(2),this.getTaxRate()},this.getTaxRate=function(){return this.$cart.taxRate},this.getTax=function(){return+parseFloat(this.getSubTotal()/100*this.getCart().taxRate).toFixed(2)},this.setCart=function(t){return this.$cart=t,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var t=0,e=this.getItems();return angular.forEach(e,function(e){t+=e.getQuantity()}),t},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var t=0;return angular.forEach(this.getCart().items,function(e){t+=e.getTotal()}),+parseFloat(t).toFixed(2)},this.totalCost=function(){return+parseFloat(this.getSubTotal()+this.getShipping()+this.getTax()).toFixed(2)},this.removeItem=function(e){this.$cart.items.splice(e,1),t.$broadcast("wgCart:itemRemoved",{}),t.$broadcast("wgCart:change",{})},this.removeItemById=function(e){var i=this.getCart();angular.forEach(i.items,function(t,r){t.getId()===e&&i.items.splice(r,1)}),this.setCart(i),t.$broadcast("wgCart:itemRemoved",{}),t.$broadcast("wgCart:change",{})},this.empty=function(){t.$broadcast("wgCart:change",{}),this.$cart.items=[],localStorage.removeItem(this.getCartName())},this.toObject=function(){if(0===this.getItems().length)return!1;var t=[];return angular.forEach(this.getItems(),function(e){t.push(e.toObject())}),{shipping:this.getShipping(),tax:this.getTax(),taxRate:this.getTaxRate(),subTotal:this.getSubTotal(),totalCost:this.totalCost(),items:t}},this.$restore=function(t){var i=this;i.init(),i.$cart.shipping=t.shipping,i.$cart.tax=t.tax,angular.forEach(t.items,function(t){i.$cart.items.push(new e(t._id,t._name,t._price,t._quantity,t._data))}),this.$save()},this.$save=function(){return i.set(this.getCartName(),JSON.stringify(this.getCart()))}}]).factory("wgCartItem",["$rootScope","$log",function(t,e){var i=function(t,e,i,r,a){this.setId(t),this.setName(e),this.setPrice(i),this.setQuantity(r),this.setData(a)};return i.prototype.setId=function(t){t?this._id=t:e.error("An ID must be provided")},i.prototype.getId=function(){return this._id},i.prototype.setName=function(t){t?this._name=t:e.error("A name must be provided")},i.prototype.getName=function(){return this._name},i.prototype.setPrice=function(t){var i=parseFloat(t);i?0>=i?e.error("A price must be over 0"):this._price=i:e.error("A price must be provided")},i.prototype.getPrice=function(){return this._price},i.prototype.setQuantity=function(i,r){var a=parseInt(i);a%1===0?(r===!0?this._quantity+=a:this._quantity=a,this._quantity<1&&(this._quantity=1)):(this._quantity=1,e.info("Quantity must be an integer and was defaulted to 1")),t.$broadcast("wgCart:change",{})},i.prototype.getQuantity=function(){return this._quantity},i.prototype.setData=function(t){t&&(this._data=t)},i.prototype.getData=function(){return this._data?this._data:void e.info("This item has no data")},i.prototype.getTotal=function(){return+parseFloat(this.getQuantity()*this.getPrice()).toFixed(2)},i.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal()}},i}]).service("store",["$window",function(t){return{get:function(e){if(t.localStorage[e]){var i=angular.fromJson(t.localStorage[e]);return JSON.parse(i)}return!1},set:function(e,i){return void 0===i?t.localStorage.removeItem(e):t.localStorage[e]=angular.toJson(i),t.localStorage[e]}}}]).controller("CartController",["$scope","wgCart",function(t,e){t.wgCart=e}]).value("version","0.0.3-rc.1"),angular.module("wgCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(t){this._obj={service:void 0,settings:void 0},this.setService=function(t){this._obj.service=t},this.setSettings=function(t){this._obj.settings=t},this.checkout=function(){var e=t.get("wgCart.fulfilment."+this._obj.service);return e.checkout(this._obj.settings)}}]).service("wgCart.fulfilment.log",["$q","$log","wgCart",function(t,e,i){this.checkout=function(){var r=t.defer();return e.info(i.toObject()),r.resolve({cart:i.toObject()}),r.promise}}]).service("wgCart.fulfilment.http",["$http","wgCart",function(t,e){this.checkout=function(i){return t.post(i.url,{data:e.toObject()})}}]).service("wgCart.fulfilment.paypal",["$http","wgCart",function(){}]);