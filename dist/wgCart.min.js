"use strict";angular.module("wgCart",["wgCart.directives"]).config([function(){}]).provider("$wgCart",function(){this.$get=function(){}}).run(["$rootScope","wgCart","wgCartItem","store",function(t,e,r,i){t.$on("wgCart:change",function(){e.$save()}),angular.isObject(i.get(this.getCartName()))?e.$restore(i.get(this.getCartName())):e.init()}]).service("wgCart",["$rootScope","wgCartItem","store",function(t,e,r){this.init=function(){this.$cart={shipping:null,taxRate:null,tax:null,items:[]},this.cartName="cart"},this.addItem=function(r,i,a,n,o){var s=this.getItemById(r);if("object"==typeof s)s.setQuantity(n,!1);else{var c=new e(r,i,a,n,o);this.$cart.items.push(c),t.$broadcast("wgCart:itemAdded",c)}t.$broadcast("wgCart:change",{})},this.getItemById=function(t){var e=this.getCart().items,r=!1;return angular.forEach(e,function(e){e.getId()===t&&(r=e)}),r},this.setCartName=function(t){this.cartName=t},this.getCartName=function(){return this.cartName},this.setShipping=function(t){return this.$cart.shipping=t,this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setTaxRate=function(t){return this.$cart.taxRate=+parseFloat(t).toFixed(2),this.getTaxRate()},this.getTaxRate=function(){return this.$cart.taxRate},this.getTax=function(){return+parseFloat(this.getSubTotal()/100*this.getCart().taxRate).toFixed(2)},this.setCart=function(t){return this.$cart=t,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var t=0,e=this.getItems();return angular.forEach(e,function(e){t+=e.getQuantity()}),t},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var t=0;return angular.forEach(this.getCart().items,function(e){t+=e.getTotal()}),+parseFloat(t).toFixed(2)},this.totalCost=function(){return+parseFloat(this.getSubTotal()+this.getShipping()+this.getTax()).toFixed(2)},this.removeItem=function(e){this.$cart.items.splice(e,1),t.$broadcast("wgCart:itemRemoved",{}),t.$broadcast("wgCart:change",{})},this.removeItemById=function(e){var r=this.getCart();angular.forEach(r.items,function(t,i){t.getId()===e&&r.items.splice(i,1)}),this.setCart(r),t.$broadcast("wgCart:itemRemoved",{}),t.$broadcast("wgCart:change",{})},this.empty=function(){t.$broadcast("wgCart:change",{}),this.$cart.items=[],localStorage.removeItem(this.getCartName())},this.toObject=function(){if(0===this.getItems().length)return!1;var t=[];return angular.forEach(this.getItems(),function(e){t.push(e.toObject())}),{shipping:this.getShipping(),tax:this.getTax(),taxRate:this.getTaxRate(),subTotal:this.getSubTotal(),totalCost:this.totalCost(),items:t}},this.$restore=function(t){var r=this;r.init(),r.$cart.shipping=t.shipping,r.$cart.tax=t.tax,angular.forEach(t.items,function(t){r.$cart.items.push(new e(t._id,t._name,t._price,t._quantity,t._data))}),this.$save()},this.$save=function(){return r.set(this.getCartName(),JSON.stringify(this.getCart()))}}]).factory("wgCartItem",["$rootScope","$log",function(t,e){var r=function(t,e,r,i,a){this.setId(t),this.setName(e),this.setPrice(r),this.setQuantity(i),this.setData(a)};return r.prototype.setId=function(t){t?this._id=t:e.error("An ID must be provided")},r.prototype.getId=function(){return this._id},r.prototype.setName=function(t){t?this._name=t:e.error("A name must be provided")},r.prototype.getName=function(){return this._name},r.prototype.setPrice=function(t){var r=parseFloat(t);r?0>=r?e.error("A price must be over 0"):this._price=r:e.error("A price must be provided")},r.prototype.getPrice=function(){return this._price},r.prototype.setQuantity=function(r,i){var a=parseInt(r);a%1===0?(i===!0?this._quantity+=a:this._quantity=a,this._quantity<1&&(this._quantity=1)):(this._quantity=1,e.info("Quantity must be an integer and was defaulted to 1")),t.$broadcast("wgCart:change",{})},r.prototype.getQuantity=function(){return this._quantity},r.prototype.setData=function(t){t&&(this._data=t)},r.prototype.getData=function(){return this._data?this._data:void e.info("This item has no data")},r.prototype.getTotal=function(){return+parseFloat(this.getQuantity()*this.getPrice()).toFixed(2)},r.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal()}},r}]).service("store",["$window",function(t){return{get:function(e){if(t.localStorage[e]){var r=angular.fromJson(t.localStorage[e]);return JSON.parse(r)}return!1},set:function(e,r){return void 0===r?t.localStorage.removeItem(e):t.localStorage[e]=angular.toJson(r),t.localStorage[e]}}}]).controller("CartController",["$scope","wgCart",function(t,e){t.wgCart=e}]).value("version","0.0.3-rc.1"),angular.module("wgCart.directives",["wgCart.fulfilment"]).controller("CartController",["$scope","wgCart",function(t,e){t.wgCart=e}]).directive("wgcartAddtocart",["wgCart",function(t){return{restrict:"E",controller:"CartController",scope:{id:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",data:"="},transclude:!0,templateUrl:"template/wgCart/addtocart.html",link:function(e,r,i){e.attrs=i,e.inCart=function(){return t.getItemById(i.id)},e.q=e.inCart()?t.getItemById(i.id).getQuantity():parseInt(e.quantity),e.qtyOpt=[];for(var a=1;a<=e.quantityMax;a++)e.qtyOpt.push(a)}}}]).directive("wgcartCart",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:"template/wgCart/cart.html",link:function(){}}}]).directive("wgcartSummary",[function(){return{restrict:"E",controller:"CartController",scope:{},transclude:!0,templateUrl:"template/wgCart/summary.html"}}]).directive("wgcartCheckout",[function(){return{restrict:"E",controller:["$scope","wgCart","fulfilmentProvider",function(t,e,r){t.wgCart=e,t.checkout=function(){r.setService(t.service),r.setSettings(t.settings);var e=r.checkout();console.log(e)}}],scope:{service:"@",settings:"="},transclude:!0,templateUrl:"template/wgCart/checkout.html"}}]),angular.module("wgCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function(t){this._obj={service:void 0,settings:void 0},this.setService=function(t){this._obj.service=t},this.setSettings=function(t){this._obj.settings=t},this.checkout=function(){var e=t.get("wgCart.fulfilment."+this._obj.service);return e.checkout(this._obj.settings)}}]).service("wgCart.fulfilment.log",["$q","$log","wgCart",function(t,e,r){this.checkout=function(){var i=t.defer();return e.info(r.toObject()),i.resolve({cart:r.toObject()}),i.promise}}]).service("wgCart.fulfilment.http",["$http","wgCart",function(t,e){this.checkout=function(r){return t.post(r.url,{data:e.toObject()})}}]).service("wgCart.fulfilment.paypal",["$http","wgCart",function(){}]);